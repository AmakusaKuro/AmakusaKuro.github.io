<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>Sharingan Services — Empower Your Vision</title>
<meta content="Modern responsive portfolio by Chandan Das with futuristic scrolling, sticky header, and theme-based backgrounds." name="description"/>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://upload.wikimedia.org/wikipedia/en/7/7e/Sharingan_triple.svg" rel="icon" type="image/png"/>
<style>
:root {
  --radius:14px;
  --maxw:1100px;
  --gap:24px;
  --ff:'Nunito', system-ui;
  --accent:#e11d48;
  --transition:0.4s ease;
  --bg-light:#f8fafc;
  --text-light:#111827;
  --muted-light:#4b5563;
  --card-light:rgba(255,255,255,0.85);
  --shadow-light:0 10px 20px rgba(0,0,0,0.05);
  --bg-dark:#0b0f19;
  --text-dark:#e2e8f0;
  --muted-dark:#94a3b8;
  --card-dark:rgba(17,25,40,0.7);
  --shadow-dark:0 10px 25px rgba(0,0,0,0.3);
}

/* THEME COLORS */
body[data-theme='dark'] {
  --bg:var(--bg-dark);
  --text:var(--text-dark);
  --muted:var(--muted-dark);
  --card:var(--card-dark);
  --shadow:var(--shadow-dark);
  --bg-image:url('itachi.png');
}
body[data-theme='light'] {
  --bg:var(--bg-light);
  --text:var(--text-light);
  --muted:var(--muted-light);
  --card:var(--card-light);
  --shadow:var(--shadow-light);
  --bg-image:url('wallpaper2you_445634.jpg');
}

/* BASE */
html,body{padding-top:80px;
  margin:0;
  padding:0;
  font-family:var(--ff);
  background:var(--bg) no-repeat center center fixed;
  background-image:var(--bg-image);
  background-size:cover;
  color:var(--text);
  transition:background-image 1s ease-in-out,background-color var(--transition),color var(--transition);
  scroll-behavior:smooth;
  overflow-x:hidden;
}
body::before {
  content:"";
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.45);
  pointer-events:none;
  transition:background-color var(--transition);
}
body[data-theme='light']::before { background:rgba(255,255,255,0.5); }

/* STICKY HEADER */
/* HEADER REFINED */
header {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 1000;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 28px;
  background: rgba(17, 25, 40, 0.9);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  box-sizing: border-box;
  transition: background 0.4s ease, padding 0.3s ease, box-shadow 0.3s ease;
}

body[data-theme='light'] header {
  background: rgba(255, 255, 255, 0.85);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

/* SCROLLED STATE */
header.scrolled {
  background: rgba(17, 25, 40, 0.6);
  padding: 10px 24px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
}
body[data-theme='light'] header.scrolled {
  background: rgba(255, 255, 255, 0.65);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
}

/* BRAND */
.brand {
  display: flex;
  align-items: center;
  gap: 12px;
  min-width: 180px;
}
.logo {
  width: 46px;
  height: 46px;
  border-radius: 12px;
  background: radial-gradient(circle, var(--accent), #7f1d1d);
  display: flex;
  justify-content: center;
  align-items: center;
  color: #fff;
  font-weight: 800;
  flex-shrink: 0;
}

/* NAVIGATION */
nav {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: 10px;
}
nav a {
  color: var(--muted);
  text-decoration: none;
  font-weight: 600;
  padding: 6px 10px;
  border-radius: 8px;
  transition: all 0.3s ease;
}
nav a:hover {
  color: var(--accent);
  background: rgba(225, 29, 72, 0.08);
}

/* CONTROL BUTTONS (Search + Theme) */
.controls {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 10px;
  flex-shrink: 0;
  min-width: fit-content;
}
.search-btn,
.theme-toggle {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--muted);
  border-radius: 8px;
  padding: 6px 10px;
  color: var(--muted);
  cursor: pointer;
  transition: all var(--transition);
  font-size: 16px;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
}
.search-btn:hover,
.theme-toggle:hover {
  color: var(--accent);
  border-color: var(--accent);
  transform: scale(1.05);
}

/* MOBILE RESPONSIVE */
@media (max-width: 700px) {
  header {
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    padding: 12px 16px;
  }
  nav {
    flex-basis: 100%;
    justify-content: center;
    gap: 6px;
  }
}

body[data-theme='light'] header {
  background: rgba(255, 255, 255, 0.9);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

header.scrolled {
  background: rgba(17, 25, 40, 0.65);
  padding: 10px 20px;
}
body[data-theme='light'] header.scrolled {
  background: rgba(255, 255, 255, 0.65);
}
body[data-theme='light'] header{
  background:rgba(255,255,255,0.8);
  border-bottom:1px solid rgba(0,0,0,0.1);
}

/* BRAND & NAV */
.brand{display:flex;align-items:center;gap:10px;}
.logo{width:48px;height:48px;border-radius:12px;background:radial-gradient(circle,var(--accent),#7f1d1d);display:flex;justify-content:center;align-items:center;color:#fff;font-weight:800;}
nav a{color:var(--muted);text-decoration:none;font-weight:600;margin:0 10px;}
nav a:hover{color:var(--accent);}

/* BUTTONS */
.theme-toggle, .search-btn{
  background:none;
  border:1px solid var(--muted);
  border-radius:8px;
  padding:6px 10px;
  color:var(--muted);
  cursor:pointer;
  transition:all var(--transition);
}
.theme-toggle:hover, .search-btn:hover{color:var(--accent);border-color:var(--accent);}

/* SEARCH BAR */
#searchBar {
  display:none;
  position:fixed;
  top:70px;
  right:20px;
  width:220px;
  background:var(--card);
  border-radius:8px;
  box-shadow:var(--shadow);
  padding:10px;
  z-index:99;
}
#searchInput {
  width:100%;
  padding:6px 10px;
  border:1px solid var(--muted);
  border-radius:6px;
  background:transparent;
  color:inherit;
}

/* FUTURISTIC SCROLL EFFECTS */
::-webkit-scrollbar {width:10px;}
::-webkit-scrollbar-track {background:rgba(50,50,50,0.4);border-radius:10px;}
::-webkit-scrollbar-thumb {
  background:linear-gradient(180deg,#e11d48,#7f1d1d);
  border-radius:10px;
  box-shadow:0 0 10px #e11d48;
}
::-webkit-scrollbar-thumb:hover {background:linear-gradient(180deg,#ff2d55,#a80e28);}

section {
  opacity:0;
  transform:translateY(50px);
  transition:opacity 0.8s ease, transform 0.8s ease;
}
section.visible {
  opacity:1;
  transform:translateY(0);
}
body::after {
  content:'';
  position:fixed;
  top:0;left:0;width:100%;height:100%;
  background:radial-gradient(circle at center,rgba(225,29,72,0.05) 0%,transparent 70%);
  pointer-events:none;
  animation:drift 20s linear infinite;
}
@keyframes drift {0%{transform:translateY(0);}50%{transform:translateY(30px);}100%{transform:translateY(0);}}

/* CARDS & CONTENT */
.container{max-width:var(--maxw);margin:auto;padding:40px 20px;}
.hero{display:grid;grid-template-columns:1fr 420px;gap:30px;align-items:center;}
.hero h1{font-size:38px;margin-bottom:10px;}
.lead{color:var(--muted);margin-bottom:20px;}
.card{background:var(--card);backdrop-filter:blur(10px);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);}
.features{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px;}
.feature h3{margin:0 0 10px;color:var(--accent);}
.profile{position:relative;width:160px;height:160px;margin:40px auto;}
.profile-pic{width:160px;height:160px;border-radius:50%;object-fit:cover;border:3px solid var(--accent);cursor:pointer;transition:transform 0.3s;}
.profile-pic:hover{transform:scale(1.05);}
.profile-name{font-size:22px;color:var(--accent);font-weight:800;margin-top:10px;text-align:center;}
footer{text-align:center;margin-top:40px;color:var(--muted);font-size:14px;}

/* CONTACT */
#contact input:focus, #contact textarea:focus {
  border-color: var(--accent);
  box-shadow: 0 0 10px rgba(225,29,72,0.6);
  outline: none;
}
#contact button.pill:hover {
  transform: scale(1.05);
  box-shadow: 0 0 25px rgba(225,29,72,0.6);
  background:linear-gradient(90deg,#ff2d55,#b91c1c);
}

/* GAME STYLES */
.game-wrap{max-width:820px;margin:24px auto;padding:18px;border-radius:12px;}
.game-canvas{width:100%;height:180px;background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.45));border-radius:10px;display:block;box-shadow:0 8px 30px rgba(0,0,0,0.35);border:1px solid rgba(255,255,255,0.03);}
.game-controls{display:flex;justify-content:space-between;align-items:center;margin-top:12px;}
.score{font-weight:800;color:var(--accent);}
.hint{color:var(--muted);font-size:13px;}
.restart{background:none;border:1px solid var(--muted);padding:8px 12px;border-radius:8px;color:var(--muted);cursor:pointer;}
.restart:hover{border-color:var(--accent);color:var(--accent);}

/* LOADER */
#loader {
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:9999;
  overflow:hidden;
}
.sharingan {
  position:relative;
  width:100px;
  height:100px;
  border:4px solid #e11d48;
  border-radius:50%;
  box-shadow:0 0 20px #e11d48;
  animation:rotate 2s linear infinite;
}
.sharingan::before,
.sharingan::after {
  content:'';
  position:absolute;
  width:14px;
  height:14px;
  background:#e11d48;
  border-radius:50%;
  box-shadow:0 0 10px #e11d48;
}
.sharingan::before { top:10px; left:50%; transform:translateX(-50%); }
.sharingan::after { bottom:10px; left:50%; transform:translateX(-50%); }
.dot {
  position:absolute;
  width:12px;
  height:12px;
  background:#e11d48;
  border-radius:50%;
  top:50%;
  left:50%;
  transform-origin:center -40px;
  animation:orbit 1.5s linear infinite;
}
@keyframes rotate { from{transform:rotate(0);} to{transform:rotate(360deg);} }
@keyframes orbit { from{transform:rotate(0);} to{transform:rotate(360deg);} }
.fade-out {opacity:0;visibility:hidden;transition:opacity 0.6s ease, visibility 0.6s ease;}
</style>
<style>
    @keyframes pulseGlow {
        0% { box-shadow: 0 0 20px rgba(225,29,72,0.3); }
        50% { box-shadow: 0 0 35px rgba(225,29,72,0.6); }
        100% { box-shadow: 0 0 20px rgba(225,29,72,0.3); }
    }
    </style></head>
<body>
<!-- LOADER -->
<div id="loader">
<div class="sharingan"><div class="dot"></div></div>
</div>
<div class="container" id="content" style="display:none;">
<header>
<div class="brand">
<div class="logo">SS</div>
<div>
<div style="font-weight:800;">Sharingan Services</div>
<div class="muted" style="font-size:13px;">Beautiful • Fast • Responsive</div>
</div>
</div>
<nav>
<a href="#features">Services</a>
<a href="#about">About</a>
<a href="#hobbies">Hobbies</a>
<a href="#games">Games</a>
<a href="#contact">Contact</a>
</nav>
<div class="controls">
<button class="search-btn" id="searchBtn">🔍</button>
<button class="theme-toggle" id="themeToggle">🌙</button>
</div>
</header>
<!-- Search Bar -->
<div id="searchBar">
<input id="searchInput" placeholder="Search sections..." type="text"/>
</div>
<main>
<section class="hero">
<div>
<h1>Empower your vision with Sharingan precision.</h1>
<p class="lead">I build elegant, high-performance websites designed to mesmerize your users and strengthen your brand.</p>
<button class="pill" onclick="document.getElementById('contact').scrollIntoView({behavior:'smooth'})">Start a Project</button>
</div>
<aside class="card">
<h3>Quick Project Setup</h3>
<ul class="muted" style="padding-left:18px;">
<li>Design + Copy</li>
<li>Responsive Layout</li>
<li>Mail Form Integrated</li>
<li>Deployment Ready</li>
</ul>
</aside>
</section>
<section id="features">
<h2>Services</h2>
<div class="features">
<div class="feature card"><h3>Design &amp; UI</h3><p class="muted">Clean, accessible interfaces built to engage and convert.</p></div>
<div class="feature card"><h3>Frontend Dev</h3><p class="muted">Fast, scalable code with HTML, CSS, JS, and React.</p></div>
<div class="feature card"><h3>Deployment</h3><p class="muted">Automated setup on Vercel, Netlify, or GitHub Pages.</p></div>
</div>
</section>
<section id="about">
<h2 style="text-align:center;">About</h2>
<div class="profile">
<img alt="Chandan Das" class="profile-pic" onclick="openModal(this)" src="me-fotor-20251030235950.jpg"/>
</div>
<h3 class="profile-name">Chandan Das</h3>
<p class="muted" style="text-align:center;max-width:600px;margin:auto;">I design and develop digital experiences that are fast, beautiful, and meaningful. Every project is crafted with attention to detail — pixel and performance both matter.</p>
</section>
<section class="card" id="hobbies" style="margin-top:40px;">
<h2 style="text-align:center;">Hobbies &amp; Interests</h2>
<p class="muted" style="text-align:center;max-width:700px;margin:20px auto;">
    Outside of coding and design, I’m an avid gamer and fitness enthusiast. I love immersing myself in story-rich and competitive titles like
    <strong>PUBG PC</strong>, <strong>Valorant</strong>, <strong>Genshin Impact</strong>, <strong>Sekiro</strong>, <strong>Ghost of Tsushima</strong>,
    and the <strong>Call of Duty</strong> and <strong>Battlefield</strong> series.
  </p>
<p class="muted" style="text-align:center;max-width:700px;margin:20px auto;">
    When I’m away from the screen, I enjoy <strong>calisthenics</strong> as my main physical workout — pushing limits, mastering balance, and staying agile.
  </p>
</section>
<!-- GAMES SECTION: Spaceship Jump (fixed/responsive) -->
<!-- Polished Contact Section -->
<section id="games-hub" style="padding:80px 20px;text-align:center;background:var(--bg);color:var(--text);transition:background 0.3s,color 0.3s;"><h2 style="font-size:2.2em;margin-bottom:40px;color:var(--accent);text-shadow:0 0 10px rgba(225,29,72,0.5);">Games Hub</h2><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:32px;max-width:1000px;margin:0 auto;"><div onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 0 25px rgba(0,0,0,0.3)'" onmouseover="this.style.transform='translateY(-6px)';this.style.boxShadow='0 0 30px rgba(225,29,72,0.4)'" style="background:var(--card);padding:32px;border-radius:18px;box-shadow:0 0 25px rgba(0,0,0,0.3);transition:transform 0.3s,box-shadow 0.3s;"><h3 style="color:var(--accent);margin-bottom:16px;font-size:1.3em;text-shadow:0 0 6px rgba(225,29,72,0.3);">Pac‑Man</h3><p style="color:var(--text);opacity:0.8;margin-bottom:24px;line-height:1.5;">Classic arcade maze chase — eat pellets, avoid ghosts, and claim the high score.</p><a href="pacman_fixed_v4.html" onmouseout="this.style.filter='brightness(1.0)'" onmouseover="this.style.filter='brightness(1.2)'" style="background:var(--accent);color:#fff;padding:12px 28px;border-radius:10px;font-weight:700;text-decoration:none;display:inline-block;transition:all 0.3s;" target="_blank">🎮 Play Pac‑Man</a></div><div onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 0 25px rgba(0,0,0,0.3)'" onmouseover="this.style.transform='translateY(-6px)';this.style.boxShadow='0 0 30px rgba(225,29,72,0.4)'" style="background:var(--card);padding:32px;border-radius:18px;box-shadow:0 0 25px rgba(0,0,0,0.3);transition:transform 0.3s,box-shadow 0.3s;display:flex;flex-direction:column;justify-content:center;align-items:center;animation:pulseGlow 3s ease-in-out infinite;"><h3 style="color:var(--accent);margin-bottom:12px;font-size:1.3em;text-shadow:0 0 6px rgba(225,29,72,0.3);">Coming Soon</h3><p style="color:var(--text);opacity:0.8;margin:0;font-size:0.95em;text-align:center;line-height:1.5;">New games will appear here soon — stay tuned for more fun!</p></div></div></section><section class="card" id="contact" style="margin-top:60px;">
<h2 style="text-align:center;font-size:28px;">Get in Touch</h2>
<p class="muted" style="text-align:center;max-width:600px;margin:10px auto 30px;">
    Whether you have an idea to discuss, a project to start, or just want to say hi — I’d love to hear from you.
  </p>
<form id="contactForm" style="display:flex;flex-direction:column;gap:20px;max-width:700px;margin:auto;">
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;">
<label style="display:flex;flex-direction:column;font-weight:600;">
        Name
        <input id="name" required="" style="margin-top:6px;padding:12px 14px;border-radius:10px;border:1px solid var(--muted);
          background:rgba(255,255,255,0.05);color:inherit;transition:0.3s;" type="text"/>
</label>
<label style="display:flex;flex-direction:column;font-weight:600;">
        Email
        <input id="email" required="" style="margin-top:6px;padding:12px 14px;border-radius:10px;border:1px solid var(--muted);
          background:rgba(255,255,255,0.05);color:inherit;transition:0.3s;" type="email"/>
</label>
</div>
<label style="display:flex;flex-direction:column;font-weight:600;">
      Message
      <textarea id="message" required="" rows="5" style="margin-top:6px;padding:12px 14px;border-radius:10px;border:1px solid var(--muted);
        background:rgba(255,255,255,0.05);color:inherit;resize:none;transition:0.3s;"></textarea>
</label>
<button class="pill" style="
      background:linear-gradient(90deg,#e11d48,#7f1d1d);
      border:none;
      color:#fff;
      font-weight:700;
      padding:12px 18px;
      border-radius:999px;
      letter-spacing:0.5px;
      transition:all 0.3s ease;
      box-shadow:0 0 15px rgba(225,29,72,0.4);
      cursor:pointer;
      align-self:center;
      min-width:180px;" type="submit">
      ✉️ Send Message
    </button>
</form>
<p class="muted" style="text-align:center;margin-top:20px;font-size:14px;">
    Messages are delivered securely via <strong>EmailJS</strong>.
  </p>
</section>
<footer>
  © <span id="year"></span> Sharingan Services • Crafted by Chandan Das
</footer>
</main></div>
<div class="modal" id="imgModal" onclick="this.style.display='none'">
<img class="modal-content" id="modalImg"/>
</div>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
/* -----------------------
   Site core: theme, loader, search, scroll reveal
   ----------------------- */
emailjs.init("erGrs0Gj00vcmV2wz");
document.getElementById('year').textContent=new Date().getFullYear();

function openModal(img){
  const modal=document.getElementById('imgModal');
  const modalImg=document.getElementById('modalImg');
  modal.style.display='flex';
  modalImg.src=img.src;
}

// CONTACT FORM
document.getElementById("contactForm").addEventListener("submit", function(e){
  e.preventDefault();
  emailjs.send("service_niampmn","template_237ojk6",{
    from_name: document.getElementById("name").value,
    from_email: document.getElementById("email").value,
    message: document.getElementById("message").value
  }).then(()=>{
    showContactSuccess();
    e.target.reset();
  },(err)=>{console.error("EmailJS error:", err);alert("Failed to send message.");});
});

// Simple success message instead of alert
function showContactSuccess(){
  const sec=document.getElementById('contact');
  const msg=document.createElement('div');
  msg.textContent='✅ Message sent — I will reply soon.';
  msg.style.cssText='text-align:center;margin-top:12px;color:var(--accent);font-weight:700;opacity:0;transition:opacity .4s';
  sec.appendChild(msg);
  requestAnimationFrame(()=>msg.style.opacity=1);
  setTimeout(()=>msg.style.opacity=0,3000);
  setTimeout(()=>msg.remove(),3600);
}

// THEME TOGGLE
const toggle=document.getElementById('themeToggle');
const body=document.body;
const savedTheme=localStorage.getItem('theme');
if(savedTheme){body.dataset.theme=savedTheme;toggle.textContent=savedTheme==='dark'?'🌙':'☀️';}
else{body.dataset.theme=window.matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light';}
toggle.addEventListener('click',()=>{
  const newTheme=body.dataset.theme==='dark'?'light':'dark';
  body.dataset.theme=newTheme;
  toggle.textContent=newTheme==='dark'?'🌙':'☀️';
  localStorage.setItem('theme',newTheme);
});

// FUTURISTIC SCROLL REVEAL
const observer = new IntersectionObserver(entries=>{
  entries.forEach(entry=>{
    if(entry.isIntersecting){ entry.target.classList.add('visible'); }
  });
},{threshold:0.2});

// Add sections to observer after content shown
function attachSectionObserver(){
  document.querySelectorAll('section').forEach(sec=>observer.observe(sec));
}

/* -----------------------
   SEARCH TOGGLE
   ----------------------- */
const searchBtn=document.getElementById('searchBtn');
const searchBar=document.getElementById('searchBar');
const searchInput=document.getElementById('searchInput');
searchBtn.addEventListener('click',()=>{
  searchBar.style.display=searchBar.style.display==='block'?'none':'block';
  if(searchBar.style.display==='block'){searchInput.focus();}
});
searchInput.addEventListener('input',()=>{
  const term=searchInput.value.toLowerCase();
  document.querySelectorAll('section').forEach(sec=>{
    const match=sec.textContent.toLowerCase().includes(term);
    sec.style.opacity=match?1:0.2;
  });
});

/* -----------------------
   LOADER (show content then trigger resize/observers)
   ----------------------- */
window.addEventListener("load", ()=>{
  const loader=document.getElementById("loader");
  const content=document.getElementById("content");
  setTimeout(()=>{
    loader.classList.add("fade-out");
    setTimeout(()=>{
      loader.style.display="none";
      content.style.display="block";

      // After content is visible, attach observers and resize canvas
      attachSectionObserver();
      if (typeof resizeGameCanvas === 'function') resizeGameCanvas();

    },600);
  },600); // slightly shorter delay
});

/* -----------------------
   GAME: Spaceship Jump (Canvas)
   Robust/responsive fix: avoid zero-size canvas when hidden
   ----------------------- */

(function(){
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  let deviceRatio = window.devicePixelRatio || 1;
  let W = 800, H = 180;

  // Resize function with fallback when bounding rect is zero
  function resizeGameCanvas(){
    deviceRatio = window.devicePixelRatio || 1;
    const container = canvas.parentElement;
    // Prefer the container's current width; fallback to window width minus margins
    const rect = container.getBoundingClientRect();
    let desiredWidth = rect.width || Math.min(820, window.innerWidth - 80) || 800;
    desiredWidth = Math.min(820, desiredWidth);
    // Use integer pixel values for crispness on high-DPI
    const backingW = Math.floor(desiredWidth * deviceRatio);
    const backingH = Math.floor(180 * deviceRatio);

    canvas.width = backingW;
    canvas.height = backingH;
    canvas.style.width = (desiredWidth) + 'px';
    canvas.style.height = '180px';

    // Reset transform so drawing uses CSS pixels scaled by deviceRatio
    ctx.setTransform(deviceRatio,0,0,deviceRatio,0,0);

    W = canvas.width / deviceRatio;
    H = canvas.height / deviceRatio;
  }

  // Expose to global so loader can call it after showing content
  window.resizeGameCanvas = resizeGameCanvas;

  // Ensure we have a valid initial size even if called early
  resizeGameCanvas();

  // Re-resize on window resize (debounced)
  let rTO;
  window.addEventListener('resize', ()=>{ clearTimeout(rTO); rTO = setTimeout(resizeGameCanvas,120); });

  // Game state
  let running = true;
  let score = 0;
  let high = Number(localStorage.getItem('ss_high') || 0);
  const scoreEl = document.getElementById('scoreDisplay');
  const highEl = document.getElementById('highScore');
  highEl.textContent = high;

  // Ship
  const ship = {
    x: 60,
    y: H - 48,
    w: 44,
    h: 22,
    vy: 0,
    gravity: 0.9,
    jumpStrength: -14,
    grounded: true,
    draw(){
      ctx.save();
      ctx.translate(this.x, this.y);
      // body
      ctx.fillStyle = 'white';
      ctx.beginPath();
      ctx.moveTo(0, -10);
      ctx.lineTo(28, -5);
      ctx.lineTo(28, 5);
      ctx.lineTo(0, 10);
      ctx.closePath();
      ctx.fill();
      // cockpit
      ctx.fillStyle = 'rgba(225,29,72,0.95)';
      ctx.fillRect(6, -6, 10, 12);
      ctx.restore();
    },
    update(){
      this.vy += this.gravity;
      this.y += this.vy;
      if(this.y >= H - 48){
        this.y = H - 48;
        this.vy = 0;
        this.grounded = true;
      } else {
        this.grounded = false;
      }
    },
    jump(){
      if(this.grounded){
        this.vy = this.jumpStrength;
        this.grounded = false;
        playSfx('jump');
      }
    },
    reset(){
      this.y = H - 48;
      this.vy = 0;
      this.grounded = true;
    }
  };

  // Obstacles
  let obstacles = [];
  let spawnTimer = 0;
  let spawnInterval = 90; // frames
  let gameSpeed = 6; // base movement speed

  function spawnObstacle(){
    const size = 18 + Math.random()*26;
    const obs = {
      x: W + 20,
      y: H - 42 - (Math.random() < 0.3 ? (10+Math.random()*30) : 0),
      w: size,
      h: size,
      vx: -gameSpeed,
      draw(){
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.fillStyle = 'rgba(130,130,130,0.95)';
        ctx.beginPath();
        ctx.arc(0,0,this.w/2,0,Math.PI*2);
        ctx.fill();
        ctx.fillStyle = 'rgba(255,255,255,0.06)';
        ctx.beginPath();
        ctx.arc(-this.w*0.12,-this.h*0.12,this.w*0.18,0,Math.PI*2);
        ctx.fill();
        ctx.restore();
      },
      update(){
        this.x += this.vx;
      }
    };
    obstacles.push(obs);
  }

  // WebAudio SFX
  const audioContext = ('AudioContext' in window) ? new AudioContext() : null;
  function playSfx(type){
    if(!audioContext || mute) return;
    const o = audioContext.createOscillator();
    const g = audioContext.createGain();
    o.connect(g);
    g.connect(audioContext.destination);
    if(type==='jump'){
      o.frequency.value = 520;
      g.gain.value = 0.02;
      o.type = 'sine';
    } else if(type==='hit'){
      o.frequency.value = 120;
      g.gain.value = 0.05;
      o.type = 'sawtooth';
    } else {
      o.frequency.value = 220;
      g.gain.value = 0.03;
    }
    o.start();
    setTimeout(()=>{ o.stop(); }, 120);
  }

  // Mute toggle
  let mute = false;
  const muteBtn = document.getElementById('muteBtn');
  muteBtn.addEventListener('click', ()=>{
    mute = !mute;
    muteBtn.textContent = mute ? '🔈' : '🔊';
  });

  // Restart button
  document.getElementById('restartBtn').addEventListener('click', resetGame);

  // Input
  window.addEventListener('keydown', (e)=>{
    if(e.code === 'Space'){
      e.preventDefault();
      if(!running) resetGame();
      ship.jump();
    }
  });
  canvas.addEventListener('mousedown', ()=>{
    if(!running) resetGame();
    ship.jump();
  });
  canvas.addEventListener('touchstart', (e)=>{
    e.preventDefault();
    if(!running) resetGame();
    ship.jump();
  }, {passive:false});

  // Collision (approx)
  function checkCollision(a,b){
    return !(a.x + a.w/2 < b.x - b.w/2 || a.x - a.w/2 > b.x + b.w/2 || a.y + a.h/2 < b.y - b.h/2 || a.y - a.h/2 > b.y + b.h/2);
  }

  // Game loop
  let frame = 0;
  function update(){
    if(!running) return;
    frame++;
    ctx.clearRect(0,0,W,H);

    // ground line
    ctx.fillStyle = 'rgba(255,255,255,0.03)';
    ctx.fillRect(0, H - 32, W, 2);

    ship.update();
    ship.draw();

    // spawn
    spawnTimer++;
    if(spawnTimer > spawnInterval){
      spawnObstacle();
      spawnTimer = 0;
      spawnInterval = 60 + Math.floor(Math.random()*60);
    }

    // obstacles
    for(let i=obstacles.length-1;i>=0;i--){
      const o = obstacles[i];
      o.vx = -gameSpeed;
      o.update();
      o.draw();
      // collision
      if(Math.abs(ship.x - o.x) < (ship.w/2 + o.w/2) && Math.abs(ship.y - o.y) < (ship.h/2 + o.h/2)){
        running = false;
        playSfx('hit');
        showGameOver();
      }
      if(o.x + o.w < -50) obstacles.splice(i,1);
    }

    // score
    if(frame % 3 === 0) {
      score++;
      scoreEl.textContent = 'Score: ' + score;
      if(score > high){ high = score; highEl.textContent = high; localStorage.setItem('ss_high', high); }
    }

    // difficulty ramp
    if(frame % 600 === 0) { gameSpeed += 0.6; }

    requestAnimationFrame(update);
  }

  function showGameOver(){
    ctx.fillStyle = 'rgba(0,0,0,0.45)';
    ctx.fillRect(0,0,W,H);
    ctx.fillStyle = 'white';
    ctx.font = '18px Nunito, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Game Over — Click or press Space to restart', W/2, H/2 - 6);
    ctx.fillStyle = 'rgba(225,29,72,0.95)';
    ctx.font = 'bold 26px Nunito, sans-serif';
    ctx.fillText('Score: ' + score, W/2, H/2 + 26);
  }

  function resetGame(){
    obstacles = [];
    spawnTimer = 0;
    spawnInterval = 90;
    gameSpeed = 6;
    score = 0;
    frame = 0;
    scoreEl.textContent = 'Score: 0';
    ship.reset();
    running = true;
    // ensure sizes are correct after any layout changes
    resizeGameCanvas();
    update();
  }

  // Expose reset for external use
  window.resetGame = resetGame;

  // Start loop after initial sizing
  resetGame();

})();
</script>
<script>
window.addEventListener('scroll', () => {
  const header = document.querySelector('header');
  if (window.scrollY > 50) {
    header.classList.add('scrolled');
  } else {
    header.classList.remove('scrolled');
  }
});
</script>
</body>
</html>
